from api_service import fetch_currency_rates, get_all_currencies


def start_converter():
    ALL_CURRENCIES = get_all_currencies()

    # 1.
    print("–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –í–∞—Å –≤ –Ω–∞—à–µ–º –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä–µ –≤–∞–ª—é—Ç! üåçüí±")

    # 2.
    print("""
    –ù–∞—à –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –±—ã—Å—Ç—Ä–æ –∏ –ª–µ–≥–∫–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤–∞–ª—é—Ç—É!
    –í–æ—Ç –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
    1. –í—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ –≤–∞–ª—é—Ç—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å.
    2. –í–≤–æ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–ª—é—Ç—ã.
    3. –£–∫–∞–∑—ã–≤–∞–µ—Ç–µ –≤–∞–ª—é—Ç—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å.
    
    –ì–æ—Ç–æ–≤—ã? –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º! üòä
    """)

    # 3. –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–ª—é—Ç
    count = 1
    for key in ALL_CURRENCIES:
        print(f"{count}. [{key}] {ALL_CURRENCIES[key]['name']}")
        count += 1

    # 4. –í–≤–æ–¥ –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã
    user_currency = input("\n–í–≤–µ–¥–∏—Ç–µ –≤–∞–ª—é—Ç—É, –∫–æ—Ç–æ—Ä—É—é —É –≤–∞—Å –µ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, RUB): ").upper()

    # 5. –í–≤–æ–¥ —Å—É–º–º—ã
    current_amount = float(input("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–æ–π –≤–∞–ª—é—Ç—ã: "))

    # 6. –í–≤–æ–¥ –≤–∞–ª—é—Ç—ã(-–π) –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
    conversion_currency = input("–í–≤–µ–¥–∏—Ç–µ –≤–∞–ª—é—Ç—É(-—ã), –≤ –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, USD –∏–ª–∏ USD,EUR): ").upper().split(',')

    # 7. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –∏ –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    currency_rates = fetch_currency_rates(user_currency, conversion_currency, current_amount)

    # 8. –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    print("\n–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:")

    if 'error' in currency_rates:
        print(f"{currency_rates['error']}")
    else:
        for currency, rate in currency_rates.items():
            print(f"{current_amount} {user_currency} = {rate:.2f} {currency}")

if __name__ == "__main__":
    start_converter()
